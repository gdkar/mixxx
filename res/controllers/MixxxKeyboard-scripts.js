MixxxKeyboardDevice = function(){
var KeyboardConfig = (function(){return {"67108874": {"control": "ViewMenu_ShowSamplers",
 "group": "[KeyboardShortcuts]"},
 "67108875": {"control": "ViewMenu_ShowMicrophone",
 "group": "[KeyboardShortcuts]"},
 "67108876": {"control": "ViewMenu_ShowVinylControl",
 "group": "[KeyboardShortcuts]"},
 "13": {"control": "reloop_exit",
 "group": "[Channel1]"},
 "67108878": {"control": "ViewMenu_ShowEffects",
 "group": "[KeyboardShortcuts]"},
// "15": {"control": "beatsync",
// "group": "[Channel2]"},
 "16": {"control": "loop_in",
 "group": "[Channel2]"},
 "17": {"control": "loop_out",
 "group": "[Channel2]"},
 "18": {"control": "reloop_exit",
 "group": "[Channel2]"},
 "19": {"control": "flanger",
 "group": "[Channel2]"},
 "24": {"control": "beatloop_4_toggle",
 "group": "[Channel1]"},
 "25": {"control": "loop_halve",
 "group": "[Channel1]"},
 "26": {"control": "loop_double",
 "group": "[Channel1]"},
  "112":{control:"SelectPrevPlaylist",group:"[Playlist]"},
  "117":{control:"SelectNextPlaylist",group:"[Playlist]"},
  "116":{control:"SelectNextTrack",group:"[Playlist]"},
  "111":{control:"SelectPrevTrack",group:"[Playlist]"},
  "34" :{control:"headGain_down",group:"[Master]"},
  "35" :{control:"headGain_up",group:"[Master]"},
  "67108898" :{control:"headMix_down",group:"[Master]"},
  "67108899" :{control:"headMix_up",group:"[Master]"},

  "33554466" :{control:"gain_down",group:"[Master]"},
  "33554467" :{control:"gain_up",group:"[Master]"},

 "67108891": {"control": "OptionsMenu_Preferences",
 "group": "[KeyboardShortcuts]"},
 "67108892": {"control": "OptionsMenu_EnableVinyl1",
 "group": "[KeyboardShortcuts]"},
 "67108893": {"control": "OptionsMenu_EnableVinyl2",
 "group": "[KeyboardShortcuts]"},
 "67108894": {"control": "OptionsMenu_EnableVinyl3",
 "group": "[KeyboardShortcuts]"},
 "67108895": {"control": "OptionsMenu_EnableVinyl4",
 "group": "[KeyboardShortcuts]"},
 "32": {"control": "loop_double",
 "group": "[Channel2]"},
 "134217764": {"control": "LoadSelectedTrackAndPlay",
 "group": "[PreviewDeck1]"},
 "33554470": {"control": "reverse",
 "group": "[Channel1]"},
 "39": {"control": "fwd",
 "group": "[Channel1]"},
 "33554472": {"control": "cue_set",
 "group": "[Channel1]"},
 "41": {"control": "cue_default",
 "group": "[Channel1]"},
 "42": {"control": "crossfader_down",
 "group": "[Master]"},
 "33554475": {"control": "crossfader_up_small",
 "group": "[Master]"},
 '28':{'control':'volume_down','group':'[Channel1]'},
 '14':{'control':'volume_up','group':'[Channel1]'},
 '33554460':{'control':'volume_down_small','group':'[Channel1]'},
 '33554446':{'control':'volume_up_small','group':'[Channel1]'},
 '29':{'control':'volume_down','group':'[Channel2]'},
 '15':{'control':'volume_up','group':'[Channel2]'},
 '33554447':{'control':'volume_up_small','group':'[Channel2]'},
 '33554461':{'control':'volume_down_small','group':'[Channel2]'},

 "44": {"control": "back",
 "group": "[Channel2]"},
 "67108909": {"control": "passthrough",
 "group": "[Channel2]"},
 "33554478": {"control": "cue_set",
 "group": "[Channel2]"},
 "47": {"control": "cue_default",
 "group": "[Channel2]"},
 "49": {"control": "talkover",
 "group": "[Microphone]"},
 "52": {"control": "hotcue_1_activate",
 "group": "[Channel1]"},
 "33554485": {"control": "hotcue_2_clear",
 "group": "[Channel1]"},
 "54": {"control": "hotcue_3_activate",
 "group": "[Channel1]"},
 "33554487": {"control": "hotcue_4_clear",
 "group": "[Channel1]"},
 "56": {"control": "filterLowKill",
 "group": "[Channel1]"},
 "100663353": {"control": "LibraryMenu_NewCrate",
 "group": "[KeyboardShortcuts]"},
 "33554490": {"control": "hotcue_1_clear",
 "group": "[Channel2]"},
 "59": {"control": "hotcue_2_activate",
 "group": "[Channel2]"},
 "60": {"control": "hotcue_3_activate",
 "group": "[Channel2]"},
 "33554442": {"control": "bpm_tap",
 "group": "[Channel1]"},
 "11": {"control": "loop_in",
 "group": "[Channel1]"},
 "12": {"control": "loop_out",
 "group": "[Channel1]"},
 "67108877": {"control": "ViewMenu_ShowPreviewDeck",
 "group": "[KeyboardShortcuts]"},
// "14": {"control": "flanger",
// "group": "[Channel1]"},
 "67108879": {"control": "ViewMenu_ShowCoverArt",
 "group": "[KeyboardShortcuts]"},
 "33554545": {"control": "LoadSelectedTrack",
 "group": "[Channel1]"},
 "134217842": {"control": "fwd",
 "group": "[PreviewDeck1]"},
 "57": {"control": "filterLowKill",
 "group": "[Channel2]"},
 "67108888": {"control": "FileMenu_Quit",
 "group": "[KeyboardShortcuts]"},
 "100663323": {"control": "OptionsMenu_ReloadSkin",
 "group": "[KeyboardShortcuts]"},
 "167772273": {"control": "eject",
 "group": "[Channel1]"},
 "56": {"control": "pfl",
 "group": "[Channel1]"},
 "33554546": {"control": "LoadSelectedTrack",
 "group": "[Channel2]"},
 "100663325": {"control": "vinylcontrol_mode",
 "group": "[Channel1]"},
 "30": {"control": "beatloop_4_toggle",
 "group": "[Channel2]"},
 "31": {"control": "loop_halve",
 "group": "[Channel2]"},
 "67108896": {"control": "FileMenu_LoadDeck1",
 "group": "[KeyboardShortcuts]"},
 "36": {"control": "start_stop",
 "group": "[PreviewDeck1]"},
 "38": {"control": "back",
 "group": "[Channel1]"},
 "40": {"control": "play_stutter",
 "group": "[Channel1]"},
 "33554473": {"control": "cue_gotoandstop",
 "group": "[Channel1]"},
 "33554474": {"control": "crossfader_down_small",
 "group": "[Master]"},
 "43": {"control": "crossfader_up",
 "group": "[Master]"},
 "67108908": {"control": "passthrough",
 "group": "[Channel1]"},
 "45": {"control": "fwd",
 "group": "[Channel2]"},
 "67108910": {"control": "OptionsMenu_EnableLiveBroadcasting",
 "group": "[KeyboardShortcuts]"},
 "33554479": {"control": "cue_gotoandstop",
 "group": "[Channel2]"},
 "57": {"control": "pfl",
 "group": "[Channel2]"},
 "61": {"control": "hotcue_4_activate",
 "group": "[Channel2]"},
 "33554476": {"control": "reverse",
 "group": "[Channel2]"},
 "10": {"control": "beatsync",
 "group": "[Channel1]"},
 "33554484": {"control": "hotcue_1_clear",
 "group": "[Channel1]"},
 "53": {"control": "hotcue_2_activate",
 "group": "[Channel1]"},
 "33554486": {"control": "hotcue_3_clear",
 "group": "[Channel1]"},
 "134217841": {"control": "back",
 "group": "[PreviewDeck1]"},
 "55": {"control": "hotcue_4_activate",
 "group": "[Channel1]"},
 "67108921": {"control": "LibraryMenu_NewPlaylist",
 "group": "[KeyboardShortcuts]"},
 "58": {"control": "hotcue_1_activate",
 "group": "[Channel2]"},
 "33554491": {"control": "hotcue_2_clear",
 "group": "[Channel2]"},
 "167772274": {"control": "eject",
 "group": "[Channel2]"},
 "33554492": {"control": "hotcue_3_clear",
 "group": "[Channel2]"},
 "46": {"control": "play",
 "group": "[Channel2]"},
 "201326621": {"control": "vinylcontrol_cueing",
 "group": "[Channel1]"},
 "33554493": {"control": "hotcue_4_clear",
 "group": "[Channel2]"},
 "100663326": {"control": "vinylcontrol_mode",
 "group": "[Channel2]"},
 "201326622": {"control": "vinylcontrol_cueing",
 "group": "[Channel2]"},
 "100663328": {"control": "FileMenu_LoadDeck2",
 "group": "[KeyboardShortcuts]"},
 '67':{'control':'rate_temp_down','group':'[Channel1]'},
 '68':{'control':'rate_temp_up','group':'[Channel1]'},
 '69':{'control':'rate_perm_down','group':'[Channel1]'},
 '70':{'control':'rate_perm_up','group':'[Channel1]'},
 '73':{'control':'rate_temp_down','group':'[Channel2]'},
 '74':{'control':'rate_temp_up','group':'[Channel2]'},
 '75':{'control':'rate_perm_down','group':'[Channel2]'},
 '76':{'control':'rate_perm_up','group':'[Channel2]'},
'33554499' :{'control':'rate_temp_down_small','group':'[Channel1]'},
 '33554500':{'control':'rate_temp_up_small','group':'[Channel1]'},
 '33554501':{'control':'rate_perm_down_small','group':'[Channel1]'},
 '33554502':{'control':'rate_perm_up_small','group':'[Channel1]'},
 '33554505':{'control':'rate_temp_down_small','group':'[Channel2]'},
 '33554506':{'control':'rate_temp_up_small','group':'[Channel2]'},
 '33554507':{'control':'rate_perm_down_small','group':'[Channel2]'},
 '33554508':{'control':'rate_perm_up_small','group':'[Channel2]'}};})();

var modmap = {"plusminus": 126,
 "XF86AudioMute": 121,
 "XF86MonBrightnessDown": 232,
 "less": 59,
 "Alt_R": 108,
 "Hangul_Hanja": 131,
 "Hangul": 130,
 "XF86Search": 225,
 "XF86AudioPrev": 173,
 "comma": 59,
 "Alt_L": 204,
 "KP_9": 81,
 "apostrophe": 48,
 "XF86Reload": 181,
 "1": 10,
 "XF86Battery": 244,
 "Control_R": 135,
 "KP_Down": 88,
 "Undo": 139,
 "XF86DOS": 159,
 "0": 19,
 "KP_Insert": 90,
 "4": 13,
 "8": 17,
 "KP_Decimal": 129,
 "XF86Send": 239,
 "slash": 61,
 "XF86WLAN": 246,
 "dollar": 13,
 "L": 46,
 "XF86Xfer": 155,
 "XF86TouchpadOff": 201,
 "9": 18,
 "b": 56,
 "T": 28,
 "underscore": 20,
 "XF86Save": 242,
 "X": 53,
 "XF86KbdLightOnOff": 236,
 "Help": 146,
 "Right": 114,
 "bar": 51,
 "d": 40,
 "Hiragana": 99,
 "h": 43,
 "Mode_switch": 203,
 "l": 46,
 "p": 33,
 "SunProps": 138,
 "t": 28,
 "Tab": 66,
 "x": 53,
 "XF86ScreenSaver": 160,
 "Find": 144,
 "NoSymbol": 246,
 "parenright": 19,
 "XF86MailForward": 241,
 "End": 115,
 "XF86LaunchA": 128,
 "XF86LaunchB": 212,
 "Next": 117,
 "XF86Display": 235,
 "grave": 49,
 "Print": 218,
 "XF86AudioStop": 174,
 "XF86Tools": 191,
 "braceleft": 34,
 "Henkan_Mode": 100,
 "KP_Home": 79,
 "space": 65,
 "KP_Equal": 125,
 "XF86Bluetooth": 245,
 "XF86WakeUp": 151,
 "XF86Calculator": 148,
 "Cancel": 231,
 "3": 12,
 "ampersand": 16,
 "parenleft": 18,
 "7": 16,
 "C": 54,
 "KP_End": 87,
 "G": 42,
 "XF86Documents": 243,
 "M": 58,
 "K": 45,
 "KP_Begin": 84,
 "Hyper_L": 207,
 "Up": 111,
 "O": 32,
 "Prior": 112,
 "S": 39,
 "W": 25,
 "XF86Forward": 167,
 "Shift_R": 62,
 "exclam": 10,
 "Delete": 119,
 "XF86Explorer": 152,
 "c": 54,
 "XF86MyComputer": 165,
 "g": 42,
 "Scroll_Lock": 78,
 "k": 45,
 "XF86AudioRewind": 176,
 "equal": 21,
 "o": 32,
 "XF86Phone": 177,
 "XF86Paste": 143,
 "XF86Launch9": 196,
 "s": 39,
 "plus": 21,
 "w": 25,
 "Escape": 9,
 "XF86Launch1": 156,
 "Katakana": 98,
 "XF86Launch3": 210,
 "XF86Launch4": 211,
 "XF86Launch5": 192,
 "XF86Launch6": 193,
 "XF86Launch7": 194,
 "Pause": 127,
 "asciicircum": 15,
 "XF86Launch2": 157,
 "XF86Shop": 229,
 "XF86AudioRecord": 175,
 "Super_L": 206,
 "XF86MenuKB": 147,
 "period": 60,
 "XF86AudioPlay": 215,
 "asciitilde": 49,
 "colon": 47,
 "XF86AudioMicMute": 198,
 "XF86TouchpadToggle": 199,
 "XF86AudioNext": 171,
 "XF86Back": 166,
 "Meta_L": 205,
 "KP_Prior": 81,
 "XF86AudioPause": 172,
 "question": 61,
 "XF86Open": 142,
 "2": 11,
 "XF86ScrollDown": 186,
 "Num_Lock": 77,
 "6": 15,
 "Shift_L": 50,
 "XF86Go": 226,
 "XF86Close": 214,
 "XF86AudioMedia": 234,
 "B": 56,
 "XF86TaskPane": 162,
 "F": 41,
 "XF86TouchpadOn": 200,
 "J": 44,
 "D": 40,
 "N": 57,
 "KP_0": 90,
 "KP_1": 87,
 "KP_2": 88,
 "R": 27,
 "KP_4": 83,
 "XF86Mail": 223,
 "KP_6": 85,
 "KP_7": 79,
 "KP_8": 80,
 "Sys_Req": 107,
 "Z": 52,
 "XF86AudioForward": 216,
 "Left": 113,
 "KP_Left": 83,
 "ISO_Level3_Shift": 92,
 "SunFront": 140,
 "f": 41,
 "XF86Finance": 227,
 "j": 44,
 "KP_Enter": 104,
 "n": 57,
 "Down": 116,
 "r": 27,
 "Break": 127,
 "v": 55,
 "XF86HomePage": 180,
 "z": 52,
 "Redo": 190,
 "minus": 20,
 "XF86Game": 228,
 "braceright": 35,
 "XF86Copy": 141,
 "semicolon": 47,
 "KP_Next": 89,
 "XF86Eject": 174,
 "backslash": 51,
 "Linefeed": 109,
 "XF86RotateWindows": 161,
 "XF86AudioRaiseVolume": 123,
 "at": 11,
 "V": 55,
 "greater": 60,
 "XF86Launch8": 195,
 "Muhenkan": 102,
 "Return": 36,
 "KP_Up": 80,
 "XF86KbdBrightnessUp": 238,
 "Meta_R": 108,
 "percent": 14,
 "ISO_Left_Tab": 23,
 "XF86Suspend": 213,
 "XF86ScrollUp": 185,
 "5": 14,
 "H": 43,
 "XF86Sleep": 150,
 "XF86AudioLowerVolume": 122,
 "bracketright": 35,
 "A": 38,
 "Insert": 118,
 "quotedbl": 48,
 "E": 26,
 "XF86Cut": 145,
 "I": 31,
 "Super_R": 134,
 "numbersign": 12,
 "BackSpace": 22,
 "asterisk": 17,
 "XF86KbdBrightnessDown": 237,
 "Q": 24,
 "XF86WebCam": 220,
 "KP_Right": 85,
 "U": 30,
 "XF86Reply": 240,
 "XF86PowerOff": 124,
 "Home": 110,
 "Y": 29,
 "Hiragana_Katakana": 101,
 "KP_Delete": 91,
 "XF86New": 189,
 "XF86MonBrightnessUp": 233,
 "a": 38,
 "XF86Messenger": 224,
 "e": 26,
 "XF86WWW": 158,
 "P": 33,
 "i": 31,
 "m": 58,
 "q": 24,
 "XF86Favorites": 164,
 "KP_3": 89,
 "u": 30,
 "y": 29,
 "bracketleft": 34,
 "KP_5": 84};
  var MixxxDebug = this.MixxxDebug   = function MixxxDebug(msg){print("[MixxxKeyboard] "+msg);}
  var MixxxDebugPrint = true;
  var MixxxKeyEvent = this.MixxxKeyEvent = function MixxxKeyEvent(data){
      this.code      = data[0] + (data[1]<<8) + (data[2]<<16);
      this.mods      = (0x7e&data[3]) <<24;
      this.scan      = data[4] + (data[5]<<8) + (data[6]<<16) + (data[7]<<24);
      this.type      = data[8] + (data[9]<<8) + (data[10]<<16) + (data[11]<<24);
  };
  MixxxKeyEvent.prototype.keyCode = function keyCode(){
    return String.fromCharCode(this.code&0xFFFFFF);
  };
  MixxxKeyEvent.prototype.modString = function modString(){
    var ret = "";
    var i = 0x02000000;
    for(;i< 0x80000000;i*=2)
      if(i&this.mods)ret+=this.Modifiers[i]+'+';
    return ret;
  };
  MixxxKeyEvent.prototype.typeString = function typeString(){
    return this.EventTypes[this.type];
  };
  MixxxKeyEvent.prototype.Modifiers = {
    0x00000000: "None",
    0x02000000: "Shift",
    0x04000000: "Ctrl",
    0x08000000: "Alt",
    0x10000000: "Meta",
    0x20000000: "Numlock",
    0x40000000: "Modeswitch"
  };
  MixxxKeyEvent.prototype.EventTypes = {
    6         : "KeyPress",
    7         : "KeyRelease",
    51        : "Shortcut",
    117       : "ShortcutOverride",
    169       : "KeyboardLayoutChange",
  };
  var incomingData = this.incomingData = function IncomingData(data,len){
    var evt = new MixxxKeyEvent(data);
    if(MixxxDebugPrint)
      MixxxDebug( (evt.scan|evt.mods).toString()+"\t"+evt.modString()+"\t"+evt.keyCode()+"\t["+evt.typeString()+"]");
    var out;
    if(out = KeyboardConfig[(evt.scan|evt.mods).toString()]){
//      MixxxDebug(out['control']+' '+out['group']);
//      if(out['control']=='play' && evt.typeString()=='KeyRelease')
//        return;
      engine.setValue(out['group'],out['control'],evt.typeString()=='KeyPress'?1:0);
    }
    if((evt.scan|evt.mods)==100663336 && evt.typeString()=='KeyPress'){
      MixxxDebugPrint = !MixxxDebugPrint;
    }
  }
}

MixxxKeyboardDevice.prototype.init = function(id){
  this.id = id;
  this.MixxxDebug("i'm a new MixxxKeyboardDevice, initialized. id = "+id);
}
MixxxKeyboardDevice.prototype.shutdown = function(){
  this.MixxxDebug("i'm the MixxxKeyboardDevice with id "+this.id+" and i'm shuttin' down.");
}
MixxxKeyboard = new MixxxKeyboardDevice();
Controller();



